"use strict";window.RTCMultiConnection=function(e,t){function n(e,t){var n="";n+="?userid="+e.userid,n+="&sessionid="+e.sessionid,n+="&msgEvent="+e.socketMessageEvent,n+="&socketCustomEvent="+e.socketCustomEvent,n+="&autoCloseEntireSession="+!!e.autoCloseEntireSession,!0===e.session.broadcast&&(n+="&oneToMany=true"),n+="&maxParticipantsAllowed="+e.maxParticipantsAllowed,e.enableScalableBroadcast&&(n+="&enableScalableBroadcast=true",n+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2)),e.socketCustomParameters&&(n+=e.socketCustomParameters);try{io.sockets={}}catch(e){}if(e.socketURL||(e.socketURL="/"),"/"!=e.socketURL.substr(e.socketURL.length-1,1))throw'"socketURL" MUST end with a slash.';e.enableLogs&&("/"==e.socketURL?console.info("socket.io is connected at: ",location.origin+"/"):console.info("socket.io is connected at: ",e.socketURL));try{e.socket=io(e.socketURL+n)}catch(t){e.socket=io.connect(e.socketURL+n,e.socketOptions)}e.socket.isIO=!0;var o=e.multiPeersHandler;e.socket.on("extra-data-updated",function(t,n){e.peers[t]&&(e.peers[t].extra=n,e.onExtraDataUpdated({userid:t,extra:n}),e.peersBackup[t]||(e.peersBackup[t]={userid:t,extra:{}}),e.peersBackup[t].extra=n)}),e.socket.on(e.socketMessageEvent,function t(n){if(n.remoteUserId==e.userid){if(e.peers[n.sender]&&e.peers[n.sender].extra!=n.message.extra&&(e.peers[n.sender].extra=n.extra,e.onExtraDataUpdated({userid:n.sender,extra:n.extra})),"next-possible-initiator"===n.message){if(e.nextPossibleInitiatorIfThisUserLeave)return;return void(e.nextPossibleInitiatorIfThisUserLeave=n.sender)}if(n.message.streamSyncNeeded&&e.peers[n.sender]){var i=e.streamEvents[n.message.streamid];if(!i||!i.stream)return;var r=n.message.action;if("ended"===r||"inactive"===r||"stream-removed"===r)return e.peersBackup[i.userid]&&(i.extra=e.peersBackup[i.userid].extra),void e.onstreamended(i);var s="both"!=n.message.type?n.message.type:null;return void("function"==typeof i.stream[r]&&i.stream[r](s))}if("connectWithAllParticipants"===n.message)return-1===e.broadcasters.indexOf(n.sender)&&e.broadcasters.push(n.sender),void o.onNegotiationNeeded({allParticipants:e.getAllParticipants(n.sender)},n.sender);if("removeFromBroadcastersList"===n.message)return void(-1!==e.broadcasters.indexOf(n.sender)&&(delete e.broadcasters[e.broadcasters.indexOf(n.sender)],e.broadcasters=c(e.broadcasters)));if("dropPeerConnection"===n.message)return void e.deletePeer(n.sender);if(n.message.allParticipants)return-1===n.message.allParticipants.indexOf(n.sender)&&n.message.allParticipants.push(n.sender),void n.message.allParticipants.forEach(function(t){o[e.peers[t]?"renegotiatePeer":"createNewPeer"](t,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:u(e.session)})});if(n.message.newParticipant){if(n.message.newParticipant==e.userid)return;if(e.peers[n.message.newParticipant])return;return void o.createNewPeer(n.message.newParticipant,n.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:u(e.session)})}if(n.message.readyForOffer||n.message.addMeAsBroadcaster){if(e.attachStreams.length&&(e.waitingForLocalMedia=!1),e.waitingForLocalMedia)return void setTimeout(function(){t(n)},1e3);e.addNewBroadcaster(n.sender)}if(n.message.newParticipationRequest&&n.sender!==e.userid){e.peers[n.sender]&&e.deletePeer(n.sender);var a={extra:n.extra||{},localPeerSdpConstraints:n.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:n.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:void 0!==n.message.isOneWay?n.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:void 0!==n.message.isDataOnly?n.message.isDataOnly:u(e.session),dontGetRemoteStream:void 0!==n.message.isOneWay?n.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!n.message.dontGetRemoteStream,connectionDescription:n,successCallback:function(){(void 0!==n.message.isOneWay?n.message.isOneWay:!!e.session.oneway||"one-way"===e.direction)&&e.addNewBroadcaster(n.sender,a),(e.session.oneway||"one-way"===e.direction||u(e.session))&&e.addNewBroadcaster(n.sender,a)}};return void e.onNewParticipant(n.sender,a)}return n.message.shiftedModerationControl?void e.onShiftedModerationControl(n.sender,n.message.broadcasters):(n.message.changedUUID&&e.peers[n.message.oldUUID]&&(e.peers[n.message.newUUID]=e.peers[n.message.oldUUID],delete e.peers[n.message.oldUUID]),n.message.userLeft?(o.onUserLeft(n.sender),void(n.message.autoCloseEntireSession&&e.leave())):void o.addNegotiatedMessage(n.message,n.sender))}}),e.socket.on("user-left",function(t){onUserLeft(t),e.onUserStatusChanged({userid:t,status:"offline",extra:e.peers[t]&&e.peers[t].extra||{}});var n={userid:t,extra:{}};e.peersBackup[n.userid]&&(n.extra=e.peersBackup[n.userid].extra),e.onleave(n),e.nextPossibleInitiatorIfThisUserLeave===t&&(e.nextPossibleInitiatorIfThisUserLeave=null,e.open(e.sessionid))});var i=!1;e.socket.resetProps=function(){i=!1},e.socket.on("connect",function(){i||(i=!0,e.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){e.socket.emit("extra-data-updated",e.extra),t&&t(e.socket)},1e3))}),e.socket.on("disconnect",function(){e.enableLogs&&console.warn("socket.io connection is closed")}),e.socket.on("join-with-password",function(t){e.onJoinWithPassword(t)}),e.socket.on("invalid-password",function(t,n){e.onInvalidPassword(t,n)}),e.socket.on("password-max-tries-over",function(t){e.onPasswordMaxTriesOver(t)}),e.socket.on("user-disconnected",function(t){t!==e.userid&&(e.onUserStatusChanged({userid:t,status:"offline",extra:e.peers[t]&&e.peers[t].extra||{}}),e.deletePeer(t))}),e.socket.on("user-connected",function(t){t!==e.userid&&e.onUserStatusChanged({userid:t,status:"online",extra:e.peers[t]&&e.peers[t].extra||{}})}),e.socket.on("closed-entire-session",function(t,n){e.leave(),e.onEntireSessionClosed({sessionid:t,userid:t,extra:n})}),e.socket.on("userid-already-taken",function(t,n){e.isInitiator=!1,e.userid=n,e.onUserIdAlreadyTaken(t,n)}),e.socket.on("logs",function(t){e.enableLogs&&console.debug("server-logs",t)}),e.socket.on("number-of-broadcast-viewers-updated",function(t){e.onNumberOfBroadcastViewersUpdated(t)}),e.socket.on("room-full",function(t){e.onRoomFull(t)}),e.socket.on("become-next-modrator",function(t){t==e.sessionid&&setTimeout(function(){e.open(t),e.socket.emit("shift-moderator-control-on-disconnect")},1e3)})}function o(e){function t(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(t){e.onFileProgress(t)},e.fbr.onBegin=function(t){e.onFileStart(t)},e.fbr.onEnd=function(t){e.onFileEnd(t)}}var n=this,o=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];e.peersBackup={},e.peers={getLength:function(){var e=0;for(var t in this)-1==o.indexOf(t)&&e++;return e},selectFirst:function(){var e;for(var t in this)-1==o.indexOf(t)&&(e=this[t]);return e},getAllParticipants:function(e){var t=[];for(var n in this)-1==o.indexOf(n)&&n!=e&&t.push(n);return t},forEach:function(t){this.getAllParticipants().forEach(function(n){t(e.peers[n])})},send:function(t,o){var i=this;if(l(t.size)||l(t.type))if("text"===t.type||t instanceof ArrayBuffer||t instanceof DataView){if("text"===t.type&&(t=JSON.stringify(t)),o){var r=e.peers[o];if(r)return r.channels.length?void r.channels.forEach(function(e){e.send(t)}):(e.peers[o].createDataChannel(),e.renegotiate(o),void setTimeout(function(){i.send(t,o)},3e3))}this.getAllParticipants().forEach(function(n){return i[n].channels.length?void i[n].channels.forEach(function(e){e.send(t)}):(e.peers[n].createDataChannel(),e.renegotiate(n),void setTimeout(function(){i[n].channels.forEach(function(e){e.send(t)})},3e3))})}else N.send({text:t,channel:this,connection:e,remoteUserId:o});else n.shareFile(t,o)}},this.uuid=e.userid,this.getLocalConfig=function(o,i,r){return r||(r={}),{streamsToShare:r.streamsToShare||{},rtcMultiConnection:e,connectionDescription:r.connectionDescription,userid:i,localPeerSdpConstraints:r.localPeerSdpConstraints,remotePeerSdpConstraints:r.remotePeerSdpConstraints,dontGetRemoteStream:!!r.dontGetRemoteStream,dontAttachLocalStream:!!r.dontAttachLocalStream,renegotiatingPeer:!!r.renegotiatingPeer,peerRef:r.peerRef,channels:r.channels||[],onLocalSdp:function(e){n.onNegotiationNeeded(e,i)},onLocalCandidate:function(t){(t=O.processCandidates(e,t))&&n.onNegotiationNeeded(t,i)},remoteSdp:o,onDataChannelMessage:function(o){if(!e.fbr&&e.enableFileSharing&&t(),"string"!=typeof o&&e.enableFileSharing){var r=this;return o instanceof ArrayBuffer||o instanceof DataView?void e.fbr.convertToObject(o,function(e){r.onDataChannelMessage(e)}):o.readyForNextChunk?void e.fbr.getNextChunk(o,function(t,n){e.peers[i].channels.forEach(function(e){e.send(t)})},i):o.chunkMissing?void e.fbr.chunkMissing(o):void e.fbr.addChunk(o,function(t){e.peers[i].peer.channel.send(t)})}n.onDataChannelMessage(o,i)},onDataChannelError:function(e){n.onDataChannelError(e,i)},onDataChannelOpened:function(e){n.onDataChannelOpened(e,i)},onDataChannelClosed:function(e){n.onDataChannelClosed(e,i)},onRemoteStream:function(t){e.peers[i]&&e.peers[i].streams.push(t),n.onGettingRemoteMedia(t,i)},onRemoteStreamRemoved:function(e){n.onRemovingRemoteMedia(e,i)},onPeerStateChanged:function(e){n.onPeerStateChanged(e),"new"===e.iceConnectionState&&n.onNegotiationStarted(i,e),"connected"===e.iceConnectionState&&n.onNegotiationCompleted(i,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(n.onUserLeft(i),n.disconnectWith(i))}}},this.createNewPeer=function(t,n){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(n=n||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!n.streamsToShare&&(n.isOneWay=!1,n.isDataOnly=!1,n.session=e.session),!n.isOneWay&&!n.isDataOnly)return n.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:n},t);n=e.setUserPreferences(n,t);var o=this.getLocalConfig(null,t,n);e.peers[t]=new g(o),this.checkIfNextPossibleInitiator(t)}},this.createAnsweringPeer=function(t,n,o){o=e.setUserPreferences(o||{},n);var i=this.getLocalConfig(t,n,o);e.peers[n]=new g(i),this.checkIfNextPossibleInitiator(n)},this.renegotiatePeer=function(t,n,o){if(e.peers[t]){n||(n={}),n.renegotiatingPeer=!0,n.peerRef=e.peers[t].peer,n.channels=e.peers[t].channels;var i=this.getLocalConfig(o,t,n);e.peers[t]=new g(i),this.checkIfNextPossibleInitiator(t)}else e.enableLogs&&console.error("Peer ("+t+") does not exist. Renegotiation skipped.")},this.replaceTrack=function(t,n,o){if(!e.peers[n])throw"This peer ("+n+") does not exist.";var i=e.peers[n].peer;return i.getSenders&&"function"==typeof i.getSenders&&i.getSenders().length?void i.getSenders().forEach(function(i){o&&i.track instanceof VideoStreamTrack&&(e.peers[n].peer.lastVideoTrack=i.track,i.replaceTrack(t)),!o&&i.track instanceof AudioStreamTrack&&(e.peers[n].peer.lastAudioTrack=i.track,i.replaceTrack(t))}):(console.warn("RTPSender.replaceTrack is NOT supported."),void this.renegotiatePeer(n))},this.onNegotiationNeeded=function(e,t){},this.addNegotiatedMessage=function(t,o){if(t.type&&t.sdp)return"answer"==t.type&&e.peers[o]&&e.peers[o].addRemoteSdp(t),"offer"==t.type&&(t.renegotiatingPeer?this.renegotiatePeer(o,null,t):this.createAnsweringPeer(t,o)),void(e.enableLogs&&console.log("Remote peer's sdp:",t.sdp));if(t.candidate)return e.peers[o]&&e.peers[o].addRemoteCandidate(t),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",t.candidate));if(t.enableMedia){e.session=t.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),t.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var i={};e.attachStreams.forEach(function(e){i[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),t.userPreferences.streamsToShare=i,n.onNegotiationNeeded({readyForOffer:!0,userPreferences:t.userPreferences},o)}t.readyForOffer&&e.onReadyForOffer(o,t.userPreferences)},this.connectNewParticipantWithAllBroadcasters=function(t,o,i){if(!e.socket.isIO&&(i=(i||"").split("|-,-|")).length){var r,s=[];i.forEach(function(e){(e=(e||"").replace(/ /g,"")).length&&(r?s.push(e):r=e)}),r&&(n.onNegotiationNeeded({newParticipant:t,userPreferences:o||!1},r),s.length&&setTimeout(function(){n.connectNewParticipantWithAllBroadcasters(t,o,s.join("|-,-|"))},3e3))}},this.onGettingRemoteMedia=function(e,t){},this.onRemovingRemoteMedia=function(e,t){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(t,n){e.onMediaError(t,n)},this.shareFile=function(n,o){if(!e.enableFileSharing)throw'"connection.enableFileSharing" is false.';t(),e.fbr.readAsArrayBuffer(n,function(t){var n=e.getAllParticipants();o&&(n=[o]),n.forEach(function(n){e.fbr.getNextChunk(t,function(t){e.peers[n].channels.forEach(function(e){e.send(t)})},n)})},{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15e3:e.chunkSize||0})};var i=new function(e){var t={};return{receive:function(n,o,i){var r=n.uuid;if(t[r]||(t[r]=[]),t[r].push(n.message),n.last){var s=t[r].join("");n.isobject&&(s=JSON.parse(s));var a=(new Date).getTime(),d=a-n.sendingTime,c={data:s,userid:o,extra:i,latency:d};e.autoTranslateText?(c.original=c.data,e.Translator.TranslateText(c.data,function(t){c.data=t,e.onmessage(c)})):e.onmessage(c),delete t[r]}}}}(e);this.onDataChannelMessage=function(t,n){i.receive(JSON.parse(t),n,e.peers[n]?e.peers[n].extra:{})},this.onDataChannelClosed=function(t,n){t.userid=n,t.extra=e.peers[n]?e.peers[n].extra:{},e.onclose(t)},this.onDataChannelError=function(t,n){t.userid=n,event.extra=e.peers[n]?e.peers[n].extra:{},e.onerror(t)},this.onDataChannelOpened=function(t,n){return e.peers[n].channels.length?void(e.peers[n].channels=[t]):(e.peers[n].channels.push(t),void e.onopen({userid:n,extra:e.peers[n]?e.peers[n].extra:{},channel:t}))},this.onPeerStateChanged=function(t){e.onPeerStateChanged(t)},this.onNegotiationStarted=function(e,t){},this.onNegotiationCompleted=function(e,t){},this.getRemoteStreams=function(t){return t=t||e.peers.getAllParticipants()[0],e.peers[t]?e.peers[t].streams:[]},this.checkIfNextPossibleInitiator=function(t){e.sessionid!==t&&(e.autoCloseEntireSession||e.isInitiator&&e.getAllParticipants().length>1||e.socket.emit(e.socketMessageEvent,{remoteUserId:t,message:"next-possible-initiator",sender:e.userid}))}}function i(e,t,n){if("undefined"!=typeof CustomEvent){var o=new CustomEvent(t,{arguments:n,__exposedProps__:n});e.dispatchEvent(o)}}function r(e,t){t.stream&&t.stream&&t.stream.addEventListener&&(t.stream.addEventListener("mute",function(n){(n=e.streamEvents[t.streamid]).session={audio:"audio"===n.muteType,video:"video"===n.muteType},e.onmute(n)},!1),t.stream.addEventListener("unmute",function(n){(n=e.streamEvents[t.streamid]).session={audio:"audio"===n.unmuteType,video:"video"===n.unmuteType},e.onunmute(n)},!1))}function s(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),t="",n=0,o=e.length;n<o;n++)t+=e[n].toString(36);return t}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function a(e,t,n){if(n.autoCreateMediaElement){var o=!1;!e.getVideoTracks||e.getVideoTracks().length||e.isVideo||e.isScreen||(o=!0),"Firefox"===DetectRTC.browser.name&&(n.session.video||n.session.screen)&&(o=!1);var i=document.createElement(o?"audio":"video");i.srcObject=e;try{i.setAttributeNode(document.createAttribute("autoplay")),i.setAttributeNode(document.createAttribute("playsinline")),i.setAttributeNode(document.createAttribute("controls"))}catch(e){i.setAttribute("autoplay",!0),i.setAttribute("playsinline",!0),i.setAttribute("controls",!0)}if("Firefox"===DetectRTC.browser.name){var r="ended";"oninactive"in i&&(r="inactive"),i.addEventListener(r,function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){r="ended","oninactive"in e&&(r="inactive"),A.onSyncNeeded(e.streamid,r),n.attachStreams.forEach(function(t,o){e.streamid===t.streamid&&delete n.attachStreams[o]});var t=[];n.attachStreams.forEach(function(e){e&&t.push(e)}),n.attachStreams=t;var o=n.streamEvents[e.streamid];if(o)return void n.onstreamended(o);this.parentNode&&this.parentNode.removeChild(this)}},!1)}var s=i.play();if(void 0!==s){var a=!1;setTimeout(function(){a||(a=!0,t(i))},1e3),s.then(function(){a||(a=!0,t(i))}).catch(function(e){a||(a=!0,t(i))})}else t(i)}else t({})}function d(e,t){window.removeEventListener(e,t),window.addEventListener(e,t,!1)}function c(e){var t=[];return e.forEach(function(e){e&&t.push(e)}),t}function u(e){return!e.audio&&!e.video&&!e.screen&&e.data}function l(e){return void 0===e}function m(e,t){return!(e.session.audio&&"two-way"===e.session.audio||("Firefox"!==DetectRTC.browser.name||!1===t)&&("Chrome"!==DetectRTC.browser.name||DetectRTC.browser.version<50||!0!==typeof t&&(void 0!==t||!e.session.audio||!e.session.screen||e.session.video||(t=!0,0))))}function f(e){return"Firefox"===DetectRTC.browser.name||"Chrome"===DetectRTC.browser.name&&{mandatory:{chromeMediaSource:e.mandatory.chromeMediaSource,chromeMediaSourceId:e.mandatory.chromeMediaSourceId}}}function p(){if("undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}function v(e){var t={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo},n=!window.enableAdapter;return"Chrome"===DetectRTC.browser.name&&DetectRTC.browser.version,"Firefox"===DetectRTC.browser.name&&DetectRTC.browser.version>=54&&(n=!1),n&&(t={mandatory:t,optional:[{VoiceActivityDetection:!1}]}),t}function g(e){function t(t){t.binaryType="arraybuffer",t.onmessage=function(t){e.onDataChannelMessage(t.data)},t.onopen=function(){e.onDataChannelOpened(t)},t.onerror=function(t){e.onDataChannelError(t)},t.onclose=function(t){e.onDataChannelClosed(t)},t.internalSend=t.send,t.send=function(e){"open"===t.readyState&&t.internalSend(e)},a.channel=t}function n(t){return window.enableAdapter?void a[t](R.sdpConstraints).then(function(t){"Safari"!==DetectRTC.browser.name&&(t.sdp=o.processSdp(t.sdp)),a.setLocalDescription(t).then(function(){o.trickleIce&&(e.onLocalSdp({type:t.type,sdp:t.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:r.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:o?o.extra:{},streamsToShare:h}),o.onSettingLocalDescription(r))},function(e){o.enableLogs&&console.error("setLocalDescription error",e)})},function(e){o.enableLogs&&console.error("sdp-error",e)}):function(t){a[t](function(t){"Safari"!==DetectRTC.browser.name&&(t.sdp=o.processSdp(t.sdp)),a.setLocalDescription(t,function(){o.trickleIce&&(e.onLocalSdp({type:t.type,sdp:t.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:r.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:o?o.extra:{},streamsToShare:h}),o.onSettingLocalDescription(r))},function(e){o.enableLogs&&console.error("setLocalDescription-error",e)})},function(e){o.enableLogs&&console.error("sdp-"+t+"-error",e)},R.sdpConstraints)}(t)}if(void 0!==window.RTCPeerConnection?T=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?T=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(T=webkitRTCPeerConnection),x=window.RTCSessionDescription||window.mozRTCSessionDescription,P=window.RTCIceCandidate||window.mozRTCIceCandidate,M=window.MediaStreamTrack,!T)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var o=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:o.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){o.addStream(e,r.userid)},this.removeStream=function(e){o.removeStream(e,r.userid)};var r=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var s={};R.sdpConstraints=v({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var a,d=!!e.renegotiatingPeer;e.remoteSdp&&(d=!!e.remoteSdp.renegotiatingPeer);var c=[];if(o.attachStreams.forEach(function(e){e&&c.push(e)}),d)a=e.peerRef;else{var u="all";(o.candidates.turn||o.candidates.relay)&&(o.candidates.stun||o.candidates.reflexive||o.candidates.host||(u="relay"));try{var l={};"Chrome"!==DetectRTC.browser.name&&(l.iceServers=o.iceServers),"Chrome"===DetectRTC.browser.name&&(l={iceServers:o.iceServers,iceTransportPolicy:o.iceTransportPolicy||u}),o.iceServers.length||(l=null,o.optionalArgument=null),a=new T(l,o.optionalArgument)}catch(e){try{l={iceServers:o.iceServers};a=new T(l)}catch(e){a=new T}}}!a.getRemoteStreams&&a.getReceivers&&(a.getRemoteStreams=function(){var e=new k;return a.getReceivers().forEach(function(t){e.addTrack(t.track)}),[e]}),!a.getLocalStreams&&a.getSenders&&(a.getLocalStreams=function(){var e=new k;return a.getSenders().forEach(function(t){e.addTrack(t.track)}),[e]}),a.onicecandidate=function(t){if(t.candidate)o.trickleIce&&e.onLocalCandidate({candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex});else if(!o.trickleIce){var n=a.localDescription;e.onLocalSdp({type:n.type,sdp:n.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:r.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:o?o.extra:{},streamsToShare:h})}},c.forEach(function(t){if(!(e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream)&&!e.dontAttachLocalStream&&(t=o.beforeAddingStream(t,r)))if(a.getLocalStreams().forEach(function(e){t&&e.id==t.id&&(t=null)}),t&&"function"==typeof a.addTrack)t.getTracks().forEach(function(e){try{a.addTrack(e,t)}catch(e){}});else if(t&&"function"==typeof a.addStream)a.addStream(t);else try{a.addStream(t)}catch(e){t&&t.getTracks().forEach(function(e){try{a.addTrack(e,t)}catch(e){}})}}),a.oniceconnectionstatechange=a.onsignalingstatechange=function(){var t=r.extra;o.peers[r.userid]&&(t=o.peers[r.userid].extra||t),a&&(e.onPeerStateChanged({iceConnectionState:a.iceConnectionState,iceGatheringState:a.iceGatheringState,signalingState:a.signalingState,extra:t,userid:r.userid}),a&&a.iceConnectionState&&-1!==a.iceConnectionState.search(/closed|failed/gi)&&r.streams instanceof Array&&r.streams.forEach(function(e){var t=o.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"};o.onstreamended(t)}))};var m={OfferToReceiveAudio:!!c.length,OfferToReceiveVideo:!!c.length};e.localPeerSdpConstraints&&(m=e.localPeerSdpConstraints),R.sdpConstraints=v(m);var f={},p="track";window.enableAdapter||(p="addstream"),a.addEventListener(p,function(t){if(t&&("track"===p&&(t.stream=t.streams[t.streams.length-1]),!f[t.stream.id]||"Safari"===DetectRTC.browser.name)){f[t.stream.id]=t.stream.id;var n={};e.remoteSdp&&e.remoteSdp.streamsToShare?n=e.remoteSdp.streamsToShare:e.streamsToShare&&(n=e.streamsToShare);var o=n[t.stream.id];o?(t.stream.isAudio=o.isAudio,t.stream.isVideo=o.isVideo,t.stream.isScreen=o.isScreen):(t.stream.isVideo=!!t.stream.getVideoTracks().length,t.stream.isAudio=!t.stream.isVideo,t.stream.isScreen=!1),t.stream.streamid=t.stream.id,"Firefox"!=DetectRTC.browser.name&&t.stream.stop||(t.stream.stop=function(){var e="ended";"oninactive"in t.stream&&(e="inactive"),i(t.stream,e)}),s[t.stream.id]=t.stream,e.onRemoteStream(t.stream)}},!1),a.onremovestream=function(t){t.stream.streamid=t.stream.id,s[t.stream.id]&&delete s[t.stream.id],e.onRemoteStreamRemoved(t.stream)},this.addRemoteCandidate=function(e){a.addIceCandidate(new P(e))},this.addRemoteSdp=function(e,t){return t=t||function(){},window.enableAdapter?("Safari"!==DetectRTC.browser.name&&(e.sdp=o.processSdp(e.sdp)),void a.setRemoteDescription(new x(e)).then(t,function(n){o.enableLogs&&console.error("setRemoteDescription failed","\n",n,"\n",e.sdp),t()})):function(e,t){t=t||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=o.processSdp(e.sdp)),a.setRemoteDescription(new x(e),t,function(n){o.enableLogs&&console.error("setRemoteDescription failed","\n",n,"\n",e.sdp),t()})}(e,t)};var g=!0;e.remoteSdp&&(g=!1),this.createDataChannel=function(){t(a.createDataChannel("sctp",{}))},!0!==o.session.data||d||(g?this.createDataChannel():a.ondatachannel=function(e){t(e.channel)}),e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(m=e.remoteSdp.remotePeerSdpConstraints),R.sdpConstraints=v(m),this.addRemoteSdp(e.remoteSdp,function(){n("createAnswer")})),"two-way"!=o.session.audio&&"two-way"!=o.session.video&&"two-way"!=o.session.screen||(R.sdpConstraints=v({OfferToReceiveAudio:"two-way"==o.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==o.session.video||"two-way"==o.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var h={};a.getLocalStreams().forEach(function(e){h[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),g&&n("createOffer"),a.nativeClose=a.close,a.close=function(){if(a){try{a.nativeClose!==a.close&&a.nativeClose()}catch(e){}a=null,r.peer=null}},this.peer=a}function h(e){function t(t,o){(function(e,t){e.mandatory&&e.mandatory.chromeMediaSource?t.isScreen=!0:e.mozMediaSource||e.mediaSource?t.isScreen=!0:e.video?t.isVideo=!0:e.audio&&(t.isAudio=!0)})(e.localMediaConstraints,t);var i="ended";"oninactive"in t&&(i="inactive"),t.addEventListener(i,function(){delete currentUserMediaRequest.streams[n],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=c(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[n]={stream:t},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&h(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(t,o)}if(!0!==currentUserMediaRequest.mutex){currentUserMediaRequest.mutex=!0;var n=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[n])t(currentUserMediaRequest.streams[n].stream,!0);else{if(!!/BB10|BlackBerry/i.test(navigator.userAgent||"")||void 0===navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=n,t(e)},function(t){e.onLocalMediaError(t,e.localMediaConstraints)});if(void 0===navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var o,i,r=function(){};navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,function(e){e(stream),o=stream},function(e){r(e),i=e}),{then:function(e){return o?void e(o):(e,{then:function(e){return i?void e(i):void(r=e)}})}}}}}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=n,t(e)}).catch(function(t){e.onLocalMediaError(t,e.localMediaConstraints)})}}else currentUserMediaRequest.queueRequests.push(e)}function w(e){if(e){if("Firefox"===DetectRTC.browser.name)return S(e);if(window.IsAndroidChrome)return I="screen",void e(!0);if("desktop"==I)return void e(!0);window.postMessage("are-you-there","*"),setTimeout(function(){e("screen"!=I)},2e3)}}function S(e){if(e){if("Firefox"!==DetectRTC.browser.name)return w(e);var t=!1;window.addEventListener("message",function n(o){var i=o.data;i&&void 0!==i.isScreenCapturingEnabled&&(t=!0,e(!0===i.isScreenCapturingEnabled),window.removeEventListener("message",n,!1))},!1),window.postMessage({checkIfScreenCapturingEnabled:!0,domains:[document.domain]},"*"),setTimeout(function(){t||e(!0)},2e3)}}function C(e,t){if(window.IsAndroidChrome)return I="screen",void t("installed-enabled");if(2!=arguments.length&&(t=e,e=window.RMCExtensionID||"ajhifddimkapgcifgcodmmfdlknahffk"),"Firefox"===DetectRTC.browser.name)return t("not-chrome");L=null,I="screen";var n=document.createElement("img");n.src="chrome-extension://"+e+"/icon.png",n.onload=function(){window.postMessage("are-you-there","*"),setTimeout(function(){t("screen"==I?"installed-disabled":"installed-enabled")},2e3)},n.onerror=function(){t("not-installed")}}function b(e,t){var n=function e(t,n){return 0==n?t:e(n,t%n)}(e,t);return e/n/(t/n)}function y(e,t){return"Firefox"===DetectRTC.browser.name?e(null,{mozMediaSource:"window",mediaSource:"window"}):(L=null,void w(function(n){var o={mandatory:{chromeMediaSource:I,maxWidth:screen.width,maxHeight:screen.height,minWidth:screen.width,minHeight:screen.height,minAspectRatio:b(screen.width,screen.height),maxAspectRatio:b(screen.width,screen.height),minFrameRate:64,maxFrameRate:128},optional:[]};return window.IsAndroidChrome?void e(null,o):"desktop"!=I||L?("desktop"==I&&(o.mandatory.chromeMediaSourceId=L),L=null,U=null,void e(null,o)):void function(e,t){if(!e)throw'"callback" parameter is mandatory.';L=null,U=e,t?window.postMessage("audio-plus-tab","*"):window.postMessage("get-sourceId","*")}(function(){o.mandatory.chromeMediaSourceId=L,e("PermissionDeniedError"==L?L:null,o),L=null},t)}))}!function(){function e(e,t){var n=0,o=!1,i=window.setInterval(function(){e()&&(window.clearInterval(i),t(o)),n++>50&&(window.clearInterval(i),t(o=!0))},10)}var t="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if(v="object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser){var n=process.versions.node.toString().replace("v","");t="Nodejs/"+n+" (NodeOS) AppleWebKit/"+n+" (KHTML, like Gecko) Nodejs/"+n+" Nodejs/"+n}!function(e){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:t,getUserMedia:function(){}},e.window=global),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}))}("undefined"!=typeof global?global:window);var o=window.navigator;void 0!==o?(void 0!==o.webkitGetUserMedia&&(o.getUserMedia=o.webkitGetUserMedia),void 0!==o.mozGetUserMedia&&(o.getUserMedia=o.mozGetUserMedia)):o={getUserMedia:function(){},userAgent:t};var i=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(o.userAgent||""),r=!(-1===o.userAgent.indexOf("Edge")||!o.msSaveOrOpenBlob&&!o.msSaveBlob),s=!!window.opera||o.userAgent.indexOf(" OPR/")>=0,a=void 0!==window.InstallTrigger,d=/^((?!chrome|android).)*safari/i.test(o.userAgent),c=!!window.chrome&&!s,u="undefined"!=typeof document&&!!document.documentMode&&!r,l={Android:function(){return o.userAgent.match(/Android/i)},BlackBerry:function(){return o.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return o.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return o.userAgent.match(/Opera Mini/i)},Windows:function(){return o.userAgent.match(/IEMobile/i)},any:function(){return l.Android()||l.BlackBerry()||l.iOS()||l.Opera()||l.Windows()},getOsName:function(){var e="Unknown OS";return l.Android()&&(e="Android"),l.BlackBerry()&&(e="BlackBerry"),l.iOS()&&(e="iOS"),l.Opera()&&(e="Opera Mini"),l.Windows()&&(e="Windows"),e}},m="Unknown OS",f="Unknown OS Version",p=function(){for(var e,t=o.appVersion,n=o.userAgent,i="-",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],s=0;e=r[s];s++)if(e.r.test(n)){i=e.s;break}var a="-";switch(/Windows/.test(i)&&(/Windows (.*)/.test(i)&&(a=/Windows (.*)/.exec(i)[1]),i="Windows"),i){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(n)&&(a=/Mac OS X (10[\.\_\d]+)/.exec(n)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(n)&&(a=/Android ([\.\_\d]+)/.exec(n)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(n)&&(a=(a=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))[1]+"."+a[2]+"."+(0|a[3]))}return{osName:i,osVersion:a}}();p&&p.osName&&"-"!=p.osName?(m=p.osName,f=p.osVersion):l.any()&&("Android"==(m=l.getOsName())&&(f=function(e){var t=(e=(e||o.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/);return!!t&&t[1]}()));var v="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===m&&v&&(m="Nodejs",f=process.versions.node.toString().replace("v",""));var g=!1,h=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!g&&e in document.createElement("canvas")&&(g=!0),!h&&e in document.createElement("video")&&(h=!0))});var w=[],S=[],C=[],b=[];o.mediaDevices&&o.mediaDevices.enumerateDevices&&(o.enumerateDevices=function(e){var t=o.mediaDevices.enumerateDevices();t&&t.then?o.mediaDevices.enumerateDevices().then(e).catch(function(){e([])}):e([])});var y=!1;void 0!==M&&"getSources"in M?y=!0:o.mediaDevices&&o.mediaDevices.enumerateDevices&&(y=!0);var k=!1,T=!1,R=!1,x=!1,P=!1,E=window.DetectRTC||{};E.browser=function(){var e,t,n,i=(o.appVersion,o.userAgent),l=o.appName,m=""+parseFloat(o.appVersion),f=parseInt(o.appVersion,10);if(s){l="Opera";try{f=(m=o.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){m="0.0.0.0",f=0}}else u?((t=i.indexOf("rv:"))>0?m=i.substring(t+3):(t=i.indexOf("MSIE"),m=i.substring(t+5)),l="IE"):c?(t=i.indexOf("Chrome"),l="Chrome",m=i.substring(t+7)):d?(t=i.indexOf("Safari"),l="Safari",m=i.substring(t+7),-1!==(t=i.indexOf("Version"))&&(m=i.substring(t+8)),-1!==o.userAgent.indexOf("Version/")&&(m=o.userAgent.split("Version/")[1].split(" ")[0])):a?(t=i.indexOf("Firefox"),l="Firefox",m=i.substring(t+8)):(e=i.lastIndexOf(" ")+1)<(t=i.lastIndexOf("/"))&&(l=i.substring(e,t),m=i.substring(t+1),l.toLowerCase()===l.toUpperCase()&&(l=o.appName));return r&&(l="Edge",m=o.userAgent.split("Edge/")[1]),-1!==(n=m.search(/[; \)]/))&&(m=m.substring(0,n)),f=parseInt(""+m,10),isNaN(f)&&(m=""+parseFloat(o.appVersion),f=parseInt(o.appVersion,10)),{fullVersion:m,version:f,name:l,isPrivateBrowsing:!1}}(),function(t){var n;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){n=!1},function(e){n=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var o;try{(o=window.indexedDB.open("test")).onerror=function(){return!0}}catch(e){n=!0}void 0===n&&e(function(){return"done"===o.readyState},function(e){e||(n=!o.result)})}else if(function(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);return!!(n&&parseInt(n[1],10)>=10)}(window.navigator.userAgent)){n=!1;try{window.indexedDB||(n=!0)}catch(e){n=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){n=!0}void 0===n&&(n=!1,window.localStorage.removeItem("test"))}}catch(e){n=!1}e(function(){return void 0!==n},function(e){t(n)})}(function(e){E.browser.isPrivateBrowsing=!!e}),E.browser["is"+E.browser.name]=!0,E.osName=m,E.osVersion=f;var O=("object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"],!1);["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){O||e in window&&(O=!0)}),E.isWebRTCSupported=O,E.isORTCSupported="undefined"!=typeof RTCIceGatherer;var D=!1;(E.browser.isChrome&&E.browser.version>=35?D=!0:E.browser.isFirefox&&E.browser.version>=34?D=!0:E.browser.isEdge&&E.browser.version>=17?D=!0:"Android"===E.osName&&E.browser.isChrome&&(D=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||""))||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(E.browser.isChrome||E.browser.isEdge||E.browser.isOpera)?D=!1:E.browser.isFirefox&&(D=!1));E.isScreenCapturingSupported=D;var A={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){A.isSupported||e in window&&(A.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(A.isCreateMediaStreamSourceSupported=!0))}),E.isAudioContextSupported=A.isSupported,E.isCreateMediaStreamSourceSupported=A.isCreateMediaStreamSourceSupported;var L=!1;E.browser.isChrome&&E.browser.version>31&&(L=!0),E.isRtpDataChannelsSupported=L;var U=!1;E.browser.isFirefox&&E.browser.version>28?U=!0:E.browser.isChrome&&E.browser.version>25?U=!0:E.browser.isOpera&&E.browser.version>=11&&(U=!0),E.isSctpDataChannelsSupported=U,E.isMobileDevice=i;var I=!1;o.getUserMedia?I=!0:o.mediaDevices&&o.mediaDevices.getUserMedia&&(I=!0),E.browser.isChrome&&E.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(I="Requires HTTPs"),"Nodejs"===E.osName&&(I=!1),E.isGetUserMediaSupported=I;var N="";screen.width&&(N+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));E.displayResolution=N,E.displayAspectRatio=function(e,t){var n=function e(t,n){return 0==n?t:e(n,t%n)}(e,t);return e/n/(t/n)}(screen.width,screen.height).toFixed(2),E.isCanvasSupportsStreamCapturing=g,E.isVideoSupportsStreamCapturing=h,"Chrome"==E.browser.name&&E.browser.version>=53&&(E.isCanvasSupportsStreamCapturing||(E.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),E.isVideoSupportsStreamCapturing||(E.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),E.DetectLocalIPAddress=function(e,t){E.isWebRTCSupported&&function(e,t){function n(t){var n=/([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(t);if(n){var o=n[1];void 0===i[o]&&e(o),i[o]=!0}}function o(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&n(e)})}if("undefined"!=typeof document&&"function"==typeof document.getElementById){var i={},r=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!r){var s=document.getElementById("iframe");if(!s)return;var a=s.contentWindow;r=a.RTCPeerConnection||a.mozRTCPeerConnection||a.webkitRTCPeerConnection}if(r){var d=null;"Chrome"===E.browser&&E.browser.version<58&&(d={optional:[{RtpDataChannels:!0}]});var c=new r({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},d);if(t&&(c.addStream?c.addStream(t):c.addTrack&&t.getTracks()[0]&&c.addTrack(t.getTracks()[0],t)),c.onicecandidate=function(e){e.candidate&&n(e.candidate.candidate)},!t)try{c.createDataChannel("sctp",{})}catch(e){}E.isPromisesSupported?c.createOffer().then(function(e){c.setLocalDescription(e).then(o)}):c.createOffer(function(e){c.setLocalDescription(e,o,function(){})},function(){})}}}(function(t){e(t.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+t:"Public: "+t)},t)},E.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,E.isWebSocketsBlocked=!E.isWebSocketsSupported,"Nodejs"===E.osName&&(E.isWebSocketsSupported=!0,E.isWebSocketsBlocked=!1),E.checkWebSocketsSupport=function(e){e=e||function(){};try{var t,n=new WebSocket("wss://echo.websocket.org:443/");n.onopen=function(){E.isWebSocketsBlocked=!1,t=(new Date).getTime(),n.send("ping")},n.onmessage=function(){E.WebsocketLatency=(new Date).getTime()-t+"ms",e(),n.close(),n=null},n.onerror=function(){E.isWebSocketsBlocked=!0,e()}}catch(t){E.isWebSocketsBlocked=!0,e()}},E.load=function(e){(function(e){if(y)if(!o.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(o.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!o.enumerateDevices&&o.enumerateDevices&&(o.enumerateDevices=o.enumerateDevices.bind(o)),o.enumerateDevices){w=[],S=[],C=[],b=[],k=!1,T=!1,R=!1,x=!1,P=!1;var t={};o.enumerateDevices(function(n){n.forEach(function(e){var n={};for(var o in e)try{"function"!=typeof e[o]&&(n[o]=e[o])}catch(e){}t[n.deviceId+n.label+n.kind]||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label?("videoinput"!==n.kind||P||(P=!0),"audioinput"!==n.kind||x||(x=!0)):(n.isCustomLabel=!0,"videoinput"===n.kind?n.label="Camera "+(b.length+1):"audioinput"===n.kind?n.label="Microphone "+(S.length+1):"audiooutput"===n.kind?n.label="Speaker "+(C.length+1):n.label="Please invoke getUserMedia once.",void 0!==E&&E.browser.isChrome&&E.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(k=!0,-1===S.indexOf(n)&&S.push(n)),"audiooutput"===n.kind&&(T=!0,-1===C.indexOf(n)&&C.push(n)),"videoinput"===n.kind&&(R=!0,-1===b.indexOf(n)&&b.push(n)),w.push(n),t[n.deviceId+n.label+n.kind]=n)}),void 0!==E&&(E.MediaDevices=w,E.hasMicrophone=k,E.hasSpeakers=T,E.hasWebcam=R,E.isWebsiteHasWebcamPermissions=P,E.isWebsiteHasMicrophonePermissions=x,E.audioInputDevices=S,E.audioOutputDevices=C,E.videoInputDevices=b),e&&e()})}else e&&e();else e&&e()})(e=e||function(){})},E.MediaDevices=void 0!==w?w:[],E.hasMicrophone=k,E.hasSpeakers=T,E.hasWebcam=R,E.isWebsiteHasWebcamPermissions=P,E.isWebsiteHasMicrophonePermissions=x,E.audioInputDevices=S,E.audioOutputDevices=C,E.videoInputDevices=b;var W=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(W=!0),E.isSetSinkIdSupported=W;var B=!1;E.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(B=!0):E.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(B=!0),E.isRTPSenderReplaceTracksSupported=B;var V=!1;E.browser.isFirefox&&E.browser.version>38&&(V=!0),E.isRemoteStreamProcessingSupported=V;var F=!1;void 0!==M&&"applyConstraints"in M.prototype&&(F=!0),E.isApplyConstraintsSupported=F;var q=!1;E.browser.isFirefox&&E.browser.version>=43&&(q=!0),E.isMultiMonitorScreenCapturingSupported=q,E.isPromisesSupported=!!("Promise"in window),E.version="1.3.6",void 0===E&&(window.DetectRTC={});var G=window.MediaStream;void 0===G&&"undefined"!=typeof webkitMediaStream&&(G=webkitMediaStream),E.MediaStream=void 0!==G&&"function"==typeof G&&Object.keys(G.prototype),E.MediaStreamTrack=void 0!==M&&Object.keys(M.prototype);var j=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;E.RTCPeerConnection=void 0!==j&&Object.keys(j.prototype),window.DetectRTC=E,"undefined"!=typeof module&&(module.exports=E),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return E})}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,t,n){e.attachEvent&&e.attachEvent("on"+t,n)}),window.attachEventListener=function(e,t,n,o){e.addEventListener(t,n,o)};var k=window.MediaStream;void 0===k&&"undefined"!=typeof webkitMediaStream&&(k=webkitMediaStream),void 0!==k&&("stop"in k.prototype||(k.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})})),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",void 0===window.enableAdapter&&("Firefox"===DetectRTC.browser.name&&DetectRTC.browser.version>=54&&(window.enableAdapter=!0),"Chrome"===DetectRTC.browser.name&&DetectRTC.browser.version,"undefined"!=typeof adapter&&adapter.browserDetails&&"string"==typeof adapter.browserDetails.browser&&(window.enableAdapter=!0)),window.enableAdapter||(void 0===URL.createObjectURL&&(URL.createObjectURL=function(e){return"blob:https://"+document.domain+"/"+s()}),"srcObject"in HTMLMediaElement.prototype||(HTMLMediaElement.prototype.srcObject=function(e){return"mozSrcObject"in this?void(this.mozSrcObject=e):void(this.src=URL.createObjectURL(e))})),document.addEventListener("deviceready",p,!1),p();var T,R={};void 0!==window.RTCPeerConnection?T=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?T=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(T=webkitRTCPeerConnection);var x=window.RTCSessionDescription||window.mozRTCSessionDescription,P=window.RTCIceCandidate||window.mozRTCIceCandidate,M=window.MediaStreamTrack,E=function(){function e(e,o){var i=n(e);return i.videoCodecNumbers?"vp8"===o&&i.vp8LineNumber===i.videoCodecNumbers[0]?e:"vp9"===o&&i.vp9LineNumber===i.videoCodecNumbers[0]?e:"h264"===o&&i.h264LineNumber===i.videoCodecNumbers[0]?e:e=t(e,o,i):e}function t(e,t,n,o){var i="";if("vp8"===t){if(!n.vp8LineNumber)return e;i=n.vp8LineNumber}if("vp9"===t){if(!n.vp9LineNumber)return e;i=n.vp9LineNumber}if("h264"===t){if(!n.h264LineNumber)return e;i=n.h264LineNumber}var r=n.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",s=[i];return o&&(s=[]),n.videoCodecNumbers.forEach(function(e){e!==i&&s.push(e)}),r+=s.join(" "),e.replace(n.videoCodecNumbersOriginal,r)}function n(e){var t={};return e.split("\n").forEach(function(e){0===e.indexOf("m=video")&&(t.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach(function(n){(n=n.trim())&&n.length&&(t.videoCodecNumbers.push(n),t.videoCodecNumbersOriginal=e)})),-1===e.indexOf("VP8/90000")||t.vp8LineNumber||(t.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||t.vp9LineNumber||(t.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||t.h264LineNumber||(t.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])}),t}function o(e,t,n){return function(e,t,n,o,i){for(var r=-1!==n?n:e.length,s=t;s<r;++s)if(0===e[s].indexOf(o)&&(!i||-1!==e[s].toLowerCase().indexOf(i.toLowerCase())))return s;return null}(e,0,-1,t,n)}function i(e){var t=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null}return{removeVPX:function(e){var o=n(e);return t(e=t(e,"vp9",o,!0),"vp8",o,!0)},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return(e=(e=(e=e.replace("a=rtcp-fb:126 nack\r\n","")).replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n")).replace("a=rtcp-fb:97 nack\r\n","")).replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")},prioritize:function(e,t){if(t&&t.getSenders&&t.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";t.getSenders().forEach(function(t){for(var n=t.getParameters(),o=0;o<n.codecs.length;o++)if(n.codecs[o].mimeType==e){n.codecs.unshift(n.codecs.splice(o,1));break}t.setParameters(n)})}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,t,n){return function(e,t,n){return t?"undefined"!=typeof isFirefox&&isFirefox?e:(n&&(t.screen?t.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),t.screen&&n&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n")),(t.audio||t.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+t.audio+"\r\n")),t.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n"):t.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.video+"\r\n")),e):e}(e,t,n)},setVideoBitrates:function(e,t){return function(e,t){var n,r=(t=t||{}).min,s=t.max,a=e.split("\r\n"),d=o(a,"a=rtpmap","VP8/90000");if(d&&(n=i(a[d])),!n)return e;var c,u=o(a,"a=rtpmap","rtx/90000");if(u&&(c=i(a[u])),!u)return e;var l=o(a,"a=fmtp:"+c.toString());if(null!==l){var m="\r\n";m+="a=fmtp:"+n+" x-google-min-bitrate="+(r||"228")+"; x-google-max-bitrate="+(s||"228"),a[l]=a[l].concat(m),e=a.join("\r\n")}return e}(e,t)},setOpusAttributes:function(e,t){return function(e,t){t=t||{};var n,r=e.split("\r\n"),s=o(r,"a=rtpmap","opus/48000");if(s&&(n=i(r[s])),!n)return e;var a=o(r,"a=fmtp:"+n.toString());if(null===a)return e;var d="";return d+="; stereo="+(void 0!==t.stereo?t.stereo:"1"),d+="; sprop-stereo="+(void 0!==t["sprop-stereo"]?t["sprop-stereo"]:"1"),void 0!==t.maxaveragebitrate&&(d+="; maxaveragebitrate="+(t.maxaveragebitrate||1048576)),void 0!==t.maxplaybackrate&&(d+="; maxplaybackrate="+(t.maxplaybackrate||1048576)),void 0!==t.cbr&&(d+="; cbr="+(void 0!==t.cbr?t.cbr:"1")),void 0!==t.useinbandfec&&(d+="; useinbandfec="+t.useinbandfec),void 0!==t.usedtx&&(d+="; usedtx="+t.usedtx),void 0!==t.maxptime&&(d+="\r\na=maxptime:"+t.maxptime),r[a]=r[a].concat(d),r.join("\r\n")}(e,t)},preferVP9:function(t){return e(t,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var t=e.split("\r\n"),n=null,o=0;o<t.length;o++)if(-1!==t[o].search("opus/48000")){var i=extractSdp(t[o],/:(\d+) opus\/48000/i);break}for(o=0;o<t.length;o++)if(-1!==t[o].search("a=fmtp")&&extractSdp(t[o],/a=fmtp:(\d+)/)===i){n=o;break}return null===n?e:(t[n]=t[n].concat("; stereo=1; sprop-stereo=1"),e=t.join("\r\n"))}}}();window.BandwidthHandler=E;var O=function(){return{processCandidates:function(e,t){var n=t.candidate,o=e.candidates,i=o.stun,r=o.turn;if(l(o.reflexive)||(i=o.reflexive),l(o.relay)||(r=o.relay),(o.host||!n.match(/typ host/g))&&(r||!n.match(/typ relay/g))&&(i||!n.match(/typ srflx/g))){var s=e.iceProtocols;if((s.udp||!n.match(/ udp /g))&&(s.tcp||!n.match(/ tcp /g)))return e.enableLogs&&console.debug("Your candidate pairs:",n),{candidate:n,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex}}}}}(),D=function(){return{getIceServers:function(e){var t=[{urls:["stun:webrtcweb.com:7788","stun:webrtcweb.com:7788?transport=udp"],username:"muazkh",credential:"muazkh"},{urls:["turn:webrtcweb.com:7788","turn:webrtcweb.com:4455?transport=udp","turn:webrtcweb.com:8877?transport=udp","turn:webrtcweb.com:8877?transport=tcp"],username:"muazkh",credential:"muazkh"},{urls:["stun:stun.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}];return void 0!==window.InstallTrigger&&(t[0].urls=t[0].urls.pop(),t[1].urls=t[1].urls.pop()),t}}}();window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var t=this.streams[e];if(t){var n=(t=t.stream).currentUserMediaRequestOptions;this.queueRequests.indexOf(n)&&(delete this.queueRequests[this.queueRequests.indexOf(n)],this.queueRequests=c(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var A=function(){function e(e){if(e)return"string"==typeof e||void 0===e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0}return{setHandlers:function(t,n,o){function r(){if(o.streamEvents[t.streamid].mediaElement){var e=o.streamEvents[t.streamid].mediaElement;e.volume=0,function e(t,n,o,i){(i=(i||0)+1)>=n||setTimeout(function(){o(),e(t,n,o,i)},t)}(200,5,function(){try{e.volume+=.2}catch(t){e.volume=1}})}}if(t&&t.addEventListener){if(void 0===n||1==n){var s="ended";"oninactive"in t&&(s="inactive"),t.addEventListener(s,function(){A.onSyncNeeded(this.streamid,s)},!1)}t.mute=function(r,s){r=e(r),void 0!==s&&(n=s),void 0!==r&&"audio"!=r||t.getAudioTracks().forEach(function(e){e.enabled=!1,o.streamEvents[t.streamid].isAudioMuted=!0}),void 0!==r&&"video"!=r||t.getVideoTracks().forEach(function(e){e.enabled=!1}),void 0!==n&&1!=n||A.onSyncNeeded(t.streamid,"mute",r),o.streamEvents[t.streamid].muteType=r||"both",i(t,"mute",r)},t.unmute=function(s,a){s=e(s),void 0!==a&&(n=a),r(),void 0!==s&&"audio"!=s||t.getAudioTracks().forEach(function(e){e.enabled=!0,o.streamEvents[t.streamid].isAudioMuted=!1}),void 0!==s&&"video"!=s||(t.getVideoTracks().forEach(function(e){e.enabled=!0}),void 0!==s&&"video"==s&&o.streamEvents[t.streamid].isAudioMuted&&function e(n){n||(n=0),++n<100&&o.streamEvents[t.streamid].isAudioMuted&&(t.mute("audio"),setTimeout(function(){e(n)},50))}()),void 0!==n&&1!=n||A.onSyncNeeded(t.streamid,"unmute",s),o.streamEvents[t.streamid].unmuteType=s||"both",i(t,"unmute",s)}}},onSyncNeeded:function(e,t,n){}}}();window.addEventListener("message",function(e){e.origin==window.location.origin&&function(e){if("PermissionDeniedError"==e){if(I="PermissionDeniedError",U)return U("PermissionDeniedError");throw new Error("PermissionDeniedError: User rejected to share his screen.")}"rtcmulticonnection-extension-loaded"==e&&(I="desktop"),e.sourceId&&U&&(L=e.sourceId,U(L))}(e.data)}),window.IsAndroidChrome=!1;try{navigator.userAgent.toLowerCase().indexOf("android")>-1&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)&&(window.IsAndroidChrome=!0)}catch(e){}var L,U,I="screen",N={send:function(e){var t=e.connection,n=e.channel,o=e.remoteUserId,i=e.text,r=t.chunkSize||1e3,a="",d=!1;(function(e){return"string"==typeof e})(i)||(d=!0,i=JSON.stringify(i));var c=s(),u=(new Date).getTime();(function e(i,s){var l={type:"text",uuid:c,sendingTime:u};i&&(s=i,l.packets=parseInt(s.length/r)),s.length>r?l.message=s.slice(0,r):(l.message=s,l.last=!0,l.isobject=d),n.send(l,o),(a=s.slice(l.message.length)).length&&setTimeout(function(){e(null,a)},t.chunkInterval||100)})(i)}},W=function(){return{handle:function(e){var t={};e.onFileStart=function(n){var o=document.createElement("div");return o.title=n.name,o.innerHTML="<label>0%</label> <progress></progress>",n.remoteUserId&&(o.innerHTML+=" (Sharing with:"+n.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(o,e.filesContainer.firstChild),n.remoteUserId?(t[n.uuid]||(t[n.uuid]={}),t[n.uuid][n.remoteUserId]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},void(t[n.uuid][n.remoteUserId].progress.max=n.maxChunks)):(t[n.uuid]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},void(t[n.uuid].progress.max=n.maxChunks))},e.onFileProgress=function(e){var n=t[e.uuid];n&&(e.remoteUserId&&!(n=t[e.uuid][e.remoteUserId])||(n.progress.value=e.currentPosition||e.maxChunks||n.progress.max,function(e,t){if(-1!==e.position){var n=+e.position.toFixed(2).split(".")[1]||100;t.innerHTML=n+"%"}}(n.progress,n.label)))},e.onFileEnd=function(e){var n=t[e.uuid];if(n){if(!e.remoteUserId||(n=t[e.uuid][e.remoteUserId])){var o=n.div;-1!=e.type.indexOf("image")?o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}else console.error("No such progress-helper element exist.",e)}}}}(),B=function(){return{handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(t,n){var o=document.createElement("script");o.type="text/javascript";var i=encodeURIComponent(t),r="method"+e.token();window[r]=function(e){return e.data&&e.data.translations[0]&&n?void n(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message?void console.error('Text translation failed. Error message: "Daily Limit Exceeded."'):e.error?void console.error(e.error.message):void console.error(e)};var s="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+r+"&q="+i;o.src=s,document.getElementsByTagName("head")[0].appendChild(o)},getListOfLanguages:function(t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var e=JSON.parse(n.responseText);if(e&&e.data&&e.data.languages)return void t(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return void console.error('Text translation failed. Error message: "Daily Limit Exceeded."');if(e.error)return void console.error(e.error.message);console.error(e)}};var o="https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en";n.open("GET",o,!0),n.send(null)}}}}}();!function(i){function c(e){if(i.socketAutoReConnect=!0,i.socket)e&&e(i.socket);else{if(void 0===n)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new n(i,function(t){e&&e(i.socket)})}}function l(e,t){if(!i.dontCaptureUserMedia&&!e.isDataOnly){var n={};e.localPeerSdpConstraints.OfferToReceiveAudio&&(n.audio=i.mediaConstraints.audio),e.localPeerSdpConstraints.OfferToReceiveVideo&&(n.video=i.mediaConstraints.video);var o=e.session||i.session;return o.oneway&&"two-way"!==o.audio&&"two-way"!==o.video&&"two-way"!==o.screen?void t():(o.oneway&&o.audio&&"two-way"===o.audio&&(o={audio:!0}),void((o.audio||o.video||o.screen)&&(o.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:m(i)}).then(function(e){e.isScreen=!0,R.onGettingLocalMedia(e),!o.audio&&!o.video||m(i)?t(e):i.invokeGetUserMedia(null,t)},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.getScreenConstraints(function(e,n){i.invokeGetUserMedia({audio:!!m(i)&&f(n),video:n,isScreen:!0},!o.audio&&!o.video||m(i)?t:i.invokeGetUserMedia(null,t))}):(o.audio||o.video)&&i.invokeGetUserMedia(null,t,o))))}t()}function p(e,t){i.closeBeforeUnload&&(!0===i.isInitiator&&i.dontMakeMeModerator(),i.peers.getAllParticipants().forEach(function(e){R.onNegotiationNeeded({userLeft:!0},e),i.peers[e]&&i.peers[e].peer&&i.peers[e].peer.close(),delete i.peers[e]}),t||i.closeSocket(),i.broadcasters=[],i.isInitiator=!1)}function v(e,t){return e?(t.audio&&e.getAudioTracks().forEach(function(e){e.applyConstraints(t.audio)}),void(t.video&&e.getVideoTracks().forEach(function(e){e.applyConstraints(t.video)}))):void(i.enableLogs&&console.error("No stream to applyConstraints."))}function g(e,t,n){return t?void R.replaceTrack(e,t,n):void i.peers.getAllParticipants().forEach(function(t){R.replaceTrack(e,t,n)})}function b(){if(i.isInitiator&&!i.session.oneway&&!i.session.broadcast&&"many-to-many"===i.direction){var e=i.broadcasters[0],t=[];i.broadcasters.forEach(function(n){n!==e&&t.push(n)}),i.autoCloseEntireSession||i.shiftModerationControl(e,t,!0)}}t=t||{useDefaultDevices:!0},i.channel=i.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var R=new o(i),x={};R.onGettingLocalMedia=function(e,t){if(t=t||function(){},!x[e.streamid]){x[e.streamid]=!0;try{e.type="local"}catch(e){}i.setStreamEndHandler(e),a(e,function(n){n.id=e.streamid,n.muted=!0,n.volume=0,-1===i.attachStreams.indexOf(e)&&i.attachStreams.push(e),void 0!==A&&A.setHandlers(e,!0,i),i.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:n,userid:i.userid,extra:i.extra,streamid:e.streamid,isAudioMuted:!0},function(e,t){if(t.stream&&t.stream.getAudioTracks&&t.stream.getAudioTracks().length){if(!e||!t)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(t.stream,{onspeaking:function(){e.onspeaking(t)},onsilence:function(){e.onsilence(t)},onvolumechange:function(n,o){e.onvolumechange&&e.onvolumechange(merge({volume:n,threshold:o},t))}})}}}(i,i.streamEvents[e.streamid]),r(i,i.streamEvents[e.streamid]),i.onstream(i.streamEvents[e.streamid]),t()},i)}},R.onGettingRemoteMedia=function(e,t){try{e.type="remote"}catch(e){}i.setStreamEndHandler(e,"remote-stream"),a(e,function(n){n.id=e.streamid,void 0!==A&&A.setHandlers(e,!1,i),i.streamEvents[e.streamid]={stream:e,type:"remote",userid:t,extra:i.peers[t]?i.peers[t].extra:{},mediaElement:n,streamid:e.streamid},r(i,i.streamEvents[e.streamid]),i.onstream(i.streamEvents[e.streamid])},i)},R.onRemovingRemoteMedia=function(e,t){var n=i.streamEvents[e.streamid];n||(n={stream:e,type:"remote",userid:t,extra:i.peers[t]?i.peers[t].extra:{},streamid:e.streamid,mediaElement:i.streamEvents[e.streamid]?i.streamEvents[e.streamid].mediaElement:null}),i.peersBackup[n.userid]&&(n.extra=i.peersBackup[n.userid].extra),i.onstreamended(n),delete i.streamEvents[e.streamid]},R.onNegotiationNeeded=function(e,t,n){t=t||e.remoteUserId,c(function(){i.socket.emit(i.socketMessageEvent,"password"in e?e:{remoteUserId:t,message:e,sender:i.userid},n||function(){})})},R.onUserLeft=function(e){i.deletePeer(e)},R.disconnectWith=function(e,t){i.socket&&i.socket.emit("disconnect-with",e,t||function(){}),i.deletePeer(e)},i.broadcasters=[],i.socketOptions={transport:"polling"},i.openOrJoin=function(e,t,n){n=n||function(){},i.checkPresence(e,function(o,r){if("function"==typeof t&&void 0!==t&&(n=t,t=null),!t&&i.password&&(t=i.password),!o)return i.waitingForLocalMedia=!0,i.isInitiator=!0,i.userid,i.userid=i.sessionid=e||i.sessionid,i.userid+="",i.socket.emit("changed-uuid",i.userid),t&&i.socket.emit("set-password",t),u(i.session)?void(i.waitingForLocalMedia=!1):void i.captureUserMedia(function(){i.waitingForLocalMedia=!1,n(o,r)});i.sessionid=r;var s,a,d=!!i.session.oneway,c=u(i.session);a={OfferToReceiveAudio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i.sdpConstraints.mandatory.OfferToReceiveVideo},s={OfferToReceiveAudio:d?!!i.session.audio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:d?!!i.session.video||!!i.session.screen:i.sdpConstraints.mandatory.OfferToReceiveVideo};var m={remoteUserId:i.sessionid,message:{newParticipationRequest:!0,isOneWay:d,isDataOnly:c,localPeerSdpConstraints:s,remotePeerSdpConstraints:a},sender:i.userid,password:t||!1};l(m.message,function(){R.onNegotiationNeeded(m),n(o,r)})})},i.waitingForLocalMedia=!1,i.open=function(e,t,n){i.waitingForLocalMedia=!0,i.isInitiator=!0,n=n||function(){},"function"==typeof t&&(n=t,t=!1),i.userid,i.userid=i.sessionid=e||i.sessionid,i.userid+="",c(function(){return i.socket.emit("changed-uuid",i.userid),i.password&&i.socket.emit("set-password",i.password),1==t&&i.becomePublicModerator(),u(i.session)?(i.waitingForLocalMedia=!1,void n()):void i.captureUserMedia(function(){i.waitingForLocalMedia=!1,n()})})},i.becomePublicModerator=function(){i.isInitiator&&i.socket.emit("become-a-public-moderator")},i.dontMakeMeModerator=function(){i.socket.emit("dont-make-me-moderator")},i.deletePeer=function(e){if(e){var t={userid:e,extra:i.peers[e]?i.peers[e].extra:{}};if(i.peersBackup[t.userid]&&(t.extra=i.peersBackup[t.userid].extra),i.onleave(t),i.peers[e]){i.peers[e].streams.forEach(function(e){e.stop()});var n=i.peers[e].peer;if(n&&"closed"!==n.iceConnectionState)try{n.close()}catch(e){}i.peers[e]&&(i.peers[e].peer=null,delete i.peers[e])}if(-1!==i.broadcasters.indexOf(e)){var o=[];i.broadcasters.forEach(function(t){t!==e&&o.push(t)}),i.broadcasters=o,b()}}},i.rejoin=function(e){if(!i.isInitiator&&e&&Object.keys(e).length){var t={};i.peers[e.remoteUserId]&&(t=i.peers[e.remoteUserId].extra,i.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(i.join(e.remoteUserId),i.onReConnecting({userid:e.remoteUserId,extra:t}))}},i.join=i.connect=function(e,t){i.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||i.sessionid,i.sessionid+="";var n=!1,o=!1,r=!1,s=!1;if(e&&e.session||!e||"string"==typeof e){var a=e&&e.session||i.session;r=!!a.oneway,s=u(a),o={OfferToReceiveAudio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i.sdpConstraints.mandatory.OfferToReceiveVideo},n={OfferToReceiveAudio:r?!!i.session.audio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r?!!i.session.video||!!i.session.screen:i.sdpConstraints.mandatory.OfferToReceiveVideo}}var d=function(){};"function"==typeof(t=t||{})&&(d=t,t={}),void 0!==t.localPeerSdpConstraints&&(n=t.localPeerSdpConstraints),void 0!==t.remotePeerSdpConstraints&&(o=t.remotePeerSdpConstraints),void 0!==t.isOneWay&&(r=t.isOneWay),void 0!==t.isDataOnly&&(s=t.isDataOnly);var m={remoteUserId:i.sessionid,message:{newParticipationRequest:!0,isOneWay:r,isDataOnly:s,localPeerSdpConstraints:n,remotePeerSdpConstraints:o},sender:i.userid,password:i.password||!1};return l(m.message,function(){c(function(){i.peers[i.sessionid]||(R.onNegotiationNeeded(m),d())})}),m},i.connectWithAllParticipants=function(e){R.onNegotiationNeeded("connectWithAllParticipants",e||i.sessionid)},i.removeFromBroadcastersList=function(e){R.onNegotiationNeeded("removeFromBroadcastersList",e||i.sessionid),i.peers.getAllParticipants(e||i.sessionid).forEach(function(e){R.onNegotiationNeeded("dropPeerConnection",e),i.deletePeer(e)}),i.attachStreams.forEach(function(e){e.stop()})},i.getUserMedia=i.captureUserMedia=function(e,t){e=e||function(){};var n=t||i.session;return i.dontCaptureUserMedia||u(n)?void e():void((n.audio||n.video||n.screen)&&(n.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:m(i)}).then(function(o){if(o.isScreen=!0,R.onGettingLocalMedia(o),!n.audio&&!n.video||m(i))e(o);else{var r={};for(var s in n)"screen"!==s&&(r[s]=n[s]);i.invokeGetUserMedia(t,e,r)}},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.getScreenConstraints(function(o,r){if(o)throw o;i.invokeGetUserMedia({audio:!!m(i)&&f(r),video:r,isScreen:!0},function(o){if(!n.audio&&!n.video||m(i))e(o);else{var r={};for(var s in n)"screen"!==s&&(r[s]=n[s]);i.invokeGetUserMedia(t,e,r)}})}):(n.audio||n.video)&&i.invokeGetUserMedia(t,e,n)))},i.closeBeforeUnload=!0,window.addEventListener("beforeunload",p,!1),i.userid=s(),i.changeUserId=function(e,t){t=t||function(){},i.userid=e||s(),i.socket.emit("changed-uuid",i.userid,t)},i.extra={},i.attachStreams=[],i.session={audio:!0,video:!0},i.enableFileSharing=!1,i.bandwidth={screen:!1,audio:!1,video:!1},i.codecs={audio:"opus",video:"VP9"},i.processSdp=function(e){return"Safari"===DetectRTC.browser.name?e:("VP8"===i.codecs.video.toUpperCase()&&(e=E.preferCodec(e,"vp8")),"VP9"===i.codecs.video.toUpperCase()&&(e=E.preferCodec(e,"vp9")),"H264"===i.codecs.video.toUpperCase()&&(e=E.preferCodec(e,"h264")),"G722"===i.codecs.audio&&(e=E.removeNonG722(e)),"Firefox"===DetectRTC.browser.name?e:((i.bandwidth.video||i.bandwidth.screen)&&(e=E.setApplicationSpecificBandwidth(e,i.bandwidth,!!i.session.screen)),i.bandwidth.video&&(e=E.setVideoBitrates(e,{min:8*i.bandwidth.video*1024,max:8*i.bandwidth.video*1024})),i.bandwidth.audio&&(e=E.setOpusAttributes(e,{maxaveragebitrate:8*i.bandwidth.audio*1024,maxplaybackrate:8*i.bandwidth.audio*1024,stereo:1,maxptime:3})),e))},void 0!==E&&(i.BandwidthHandler=i.CodecsHandler=E),i.mediaConstraints={audio:{mandatory:{},optional:i.bandwidth.audio?[{bandwidth:8*i.bandwidth.audio*1024||1048576}]:[]},video:{mandatory:{},optional:i.bandwidth.video?[{bandwidth:8*i.bandwidth.video*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(i.mediaConstraints={audio:!0,video:!0}),t.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load(function(){var e,t;if(DetectRTC.MediaDevices.forEach(function(n){"audioinput"===n.kind&&!1!==i.mediaConstraints.audio&&(e=n),"videoinput"===n.kind&&!1!==i.mediaConstraints.video&&(t=n)}),e){if("Firefox"===DetectRTC.browser.name)return void(!0!==i.mediaConstraints.audio?i.mediaConstraints.audio.deviceId=e.id:i.mediaConstraints.audio={deviceId:e.id});1==i.mediaConstraints.audio&&(i.mediaConstraints.audio={mandatory:{},optional:[]}),i.mediaConstraints.audio.optional||(i.mediaConstraints.audio.optional=[]);var n=[{sourceId:e.id}];i.mediaConstraints.audio.optional=n.concat(i.mediaConstraints.audio.optional)}if(t){if("Firefox"===DetectRTC.browser.name)return void(!0!==i.mediaConstraints.video?i.mediaConstraints.video.deviceId=t.id:i.mediaConstraints.video={deviceId:t.id});1==i.mediaConstraints.video&&(i.mediaConstraints.video={mandatory:{},optional:[]}),i.mediaConstraints.video.optional||(i.mediaConstraints.video.optional=[]);n=[{sourceId:t.id}];i.mediaConstraints.video.optional=n.concat(i.mediaConstraints.video.optional)}}),i.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},i.rtcpMuxPolicy="require",i.iceTransportPolicy=null,i.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},i.iceServers=D.getIceServers(i),i.candidates={host:!0,stun:!0,turn:!0},i.iceProtocols={tcp:!0,udp:!0},i.onopen=function(e){i.enableLogs&&console.info("Data connection has been opened between you & ",e.userid)},i.onclose=function(e){i.enableLogs&&console.warn("Data connection has been closed between you & ",e.userid)},i.onerror=function(e){i.enableLogs&&console.error(e.userid,"data-error",e)},i.onmessage=function(e){i.enableLogs&&console.debug("data-message",e.userid,e.data)},i.send=function(e,t){i.peers.send(e,t)},i.close=i.disconnect=i.leave=function(){p(0,!0)},i.closeEntireSession=function(e){e=e||function(){},i.socket.emit("close-entire-session",function t(){return i.getAllParticipants().length?void setTimeout(t,100):(i.onEntireSessionClosed({sessionid:i.sessionid,userid:i.userid,extra:i.extra}),void i.changeUserId(null,function(){i.close(),e()}))})},i.onEntireSessionClosed=function(e){i.enableLogs&&console.info("Entire session is closed: ",e.sessionid,e.extra)},i.onstream=function(e){var t=i.videosContainer;t.insertBefore(e.mediaElement,t.firstChild);var n=e.mediaElement.play();return void 0!==n?void n.catch(function(){}).then(function(){setTimeout(function(){e.mediaElement.play()},2e3)}):void setTimeout(function(){e.mediaElement.play()},2e3)},i.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},i.direction="many-to-many",i.removeStream=function(e,t){var n;return i.attachStreams.forEach(function(t){t.id===e&&(n=t)}),n?(i.peers.getAllParticipants().forEach(function(e){if(!t||e===t){var o=i.peers[e];try{o.peer.removeStream(n)}catch(e){}}}),void i.renegotiate()):void console.warn("No such stream exist.",e)},i.addStream=function(e,t){function n(n){e.streamCallback&&e.streamCallback(n),i.renegotiate(t)}return e.getAudioTracks?(-1===i.attachStreams.indexOf(e)&&(e.streamid||(e.streamid=e.id),i.attachStreams.push(e)),void i.renegotiate(t)):u(e)?void i.renegotiate(t):void((e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:m(i)}).then(function(t){t.isScreen=!0,R.onGettingLocalMedia(t),!e.audio&&!e.video||m(i)?n(t):i.invokeGetUserMedia(null,function(e){n(e)})},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.getScreenConstraints(function(t,o){return t?"PermissionDeniedError"===t?(e.streamCallback&&e.streamCallback(null),void(i.enableLogs&&console.error("User rejected to share his screen."))):alert(t):void i.invokeGetUserMedia({audio:!!m(i)&&f(o),video:o,isScreen:!0},function(t){!e.audio&&!e.video||m(i)?n(t):i.invokeGetUserMedia(null,function(e){n(e)})})}):(e.audio||e.video)&&i.invokeGetUserMedia(null,n)))},i.invokeGetUserMedia=function(e,t,n){n||(n=i.session),e||(e=i.mediaConstraints),h({onGettingLocalMedia:function(n){var o=e.video;o&&(o.mediaSource||o.mozMediaSource?n.isScreen=!0:o.mandatory&&o.mandatory.chromeMediaSource&&(n.isScreen=!0)),n.isScreen||(n.isVideo=n.getVideoTracks().length,n.isAudio=!n.isVideo&&n.getAudioTracks().length),R.onGettingLocalMedia(n,function(){"function"==typeof t&&t(n)})},onLocalMediaError:function(e,t){R.onLocalMediaError(e,t)},localMediaConstraints:e||{audio:!!n.audio&&e.audio,video:!!n.video&&e.video}})},i.applyConstraints=function(e,t){if(M&&M.prototype.applyConstraints){var n;if(t)return i.streamEvents[t]&&(n=i.streamEvents[t].stream),void v(n,e);i.attachStreams.forEach(function(t){v(t,e)})}else alert("track.applyConstraints is NOT supported in your browser.")},i.replaceTrack=function(e,t,n){function o(o){i.replaceTrack(o,t,n||e.video||e.screen)}if(e=e||{},T.prototype.getSenders)if(e instanceof M)g(e,t,n);else{if(e instanceof k)return e.getVideoTracks().length&&g(e.getVideoTracks()[0],t,!0),void(e.getAudioTracks().length&&g(e.getAudioTracks()[0],t,!1));if(u(e))throw"connection.replaceTrack requires audio and/or video and/or screen.";(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:m(i)}).then(function(t){t.isScreen=!0,R.onGettingLocalMedia(t),!e.audio&&!e.video||m(i)?o(t):i.invokeGetUserMedia(null,o)},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.getScreenConstraints(function(t,n){return t?alert(t):void i.invokeGetUserMedia({audio:!!m(i)&&f(n),video:n,isScreen:!0},!e.audio&&!e.video||m(i)?o:i.invokeGetUserMedia(null,o))}):(e.audio||e.video)&&i.invokeGetUserMedia(null,o))}else i.addStream(e)},i.resetTrack=function(e,t){e||(e=i.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach(function(e){var n=i.peers[e].peer;void 0!==t&&!0!==t||!n.lastVideoTrack||i.replaceTrack(n.lastVideoTrack,e,!0),void 0!==t&&!1!==t||!n.lastAudioTrack||i.replaceTrack(n.lastAudioTrack,e,!1)})},i.renegotiate=function(e){return e?void R.renegotiatePeer(e):void i.peers.getAllParticipants().forEach(function(e){R.renegotiatePeer(e)})},i.setStreamEndHandler=function(e,t){if(e&&e.addEventListener&&(t=!!t,!e.alreadySetEndHandler)){e.alreadySetEndHandler=!0;var n="ended";"oninactive"in e&&(n="inactive"),e.addEventListener(n,function(){if(e.idInstance&&currentUserMediaRequest.remove(e.idInstance),!t){var n=[];i.attachStreams.forEach(function(t){t.id!=e.id&&n.push(t)}),i.attachStreams=n}var o=i.streamEvents[e.streamid];if(o||(o={stream:e,streamid:e.streamid,type:t?"remote":"local",userid:i.userid,extra:i.extra,mediaElement:i.streamEvents[e.streamid]?i.streamEvents[e.streamid].mediaElement:null}),t&&i.peers[o.userid]){n=[];i.peers[o.userid].peer.getRemoteStreams().forEach(function(t){t.id!=e.id&&n.push(t)}),i.peers[o.userid].streams=n}o.userid===i.userid&&"remote"===o.type||(i.peersBackup[o.userid]&&(o.extra=i.peersBackup[o.userid].extra),i.onstreamended(o),delete i.streamEvents[e.streamid])},!1)}},i.onMediaError=function(e,t){i.enableLogs&&console.error(e,t)},i.addNewBroadcaster=function(e,t){i.socket.isIO||(i.broadcasters.length&&setTimeout(function(){R.connectNewParticipantWithAllBroadcasters(e,t,i.broadcasters.join("|-,-|"))},1e4),i.session.oneway||i.session.broadcast||"many-to-many"!==i.direction||-1!==i.broadcasters.indexOf(e)||(i.broadcasters.push(e),b()))},i.autoCloseEntireSession=!1,i.filesContainer=i.videosContainer=document.body||document.documentElement,i.isInitiator=!1,i.shareFile=R.shareFile,void 0!==W&&W.handle(i),void 0!==B&&B.handle(i),i.token=s,i.onNewParticipant=function(e,t){i.acceptParticipationRequest(e,t)},i.acceptParticipationRequest=function(e,t){t.successCallback&&(t.successCallback(),delete t.successCallback),R.createNewPeer(e,t)},i.onShiftedModerationControl=function(e,t){i.acceptModerationControl(e,t)},i.acceptModerationControl=function(e,t){i.isInitiator=!0,i.broadcasters=t,i.peers.getAllParticipants().forEach(function(t){R.onNegotiationNeeded({changedUUID:e,oldUUID:i.userid,newUUID:e},t)}),i.userid=e,i.changeUserId(i.userid)},i.shiftModerationControl=function(e,t,n){R.onNegotiationNeeded({shiftedModerationControl:!0,broadcasters:t,firedOnLeave:!!n},e)},void 0!==A&&(i.StreamsHandler=A),i.onleave=function(e){},i.invokeSelectFileDialog=function(e){var t=new FileSelector;t.accept="*.*",t.selectSingleFile(e)},i.getPublicModerators=i.getPublicUsers=function(e,t){"function"==typeof e&&(t=e),c(function(){i.socket.emit("get-public-moderators","string"==typeof e?e:"",t)})},i.onmute=function(e){if(e&&e.mediaElement)if("both"===e.muteType||"video"===e.muteType){e.mediaElement.src=null;var t=e.mediaElement.pause();void 0!==t?t.then(function(){e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}):e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}else"audio"===e.muteType&&(e.mediaElement.muted=!0)},i.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.srcObject=e.stream,e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},i.onExtraDataUpdated=function(e){e.status="online",i.onUserStatusChanged(e,!0)},i.onJoinWithPassword=function(e){console.warn(e,"is password protected. Please join with password.")},i.onInvalidPassword=function(e,t){console.warn(e,"is password protected. Please join with valid password. Your old password",t,"is wrong.")},i.onPasswordMaxTriesOver=function(e){console.warn(e,"is password protected. Your max password tries exceeded the limit.")},i.getAllParticipants=function(e){return i.peers.getAllParticipants(e)},void 0!==A&&(A.onSyncNeeded=function(e,t,n){i.peers.getAllParticipants().forEach(function(o){R.onNegotiationNeeded({streamid:e,action:t,streamSyncNeeded:!0,type:n||"both"},o)})}),i.connectSocket=function(e){c(e)},i.closeSocket=function(){try{io.sockets={}}catch(e){}i.socket&&("function"==typeof i.socket.disconnect&&i.socket.disconnect(),"function"==typeof i.socket.resetProps&&i.socket.resetProps(),i.socket=null)},i.getSocket=function(e){return i.socket?e&&e(i.socket):c(e),i.socket},i.getRemoteStreams=R.getRemoteStreams;var P=["selectFirst","selectAll","forEach"];if(i.streamEvents={selectFirst:function(e){if(!e){var t;for(var n in i.streamEvents)-1!==P.indexOf(n)||t||(t=i.streamEvents[n]);return t}},selectAll:function(){}},i.socketURL="/",i.socketMessageEvent="RTCMultiConnection-Message",i.socketCustomEvent="RTCMultiConnection-Custom-Message",i.DetectRTC=DetectRTC,i.setCustomSocketEvent=function(e){e&&(i.socketCustomEvent=e),i.socket&&i.socket.emit("set-custom-socket-event-listener",i.socketCustomEvent)},i.getNumberOfBroadcastViewers=function(e,t){i.socket&&e&&t&&i.socket.emit("get-number-of-users-in-specific-broadcast",e,t)},i.onNumberOfBroadcastViewersUpdated=function(e){i.enableLogs&&i.isInitiator&&console.info("Number of broadcast (",e.broadcastId,") viewers",e.numberOfBroadcastViewers)},i.onUserStatusChanged=function(e,t){i.enableLogs&&!t&&console.info(e.userid,e.status)},i.getUserMediaHandler=h,i.multiPeersHandler=R,i.enableLogs=!0,i.setCustomSocketHandler=function(e){void 0!==n&&(n=e)},i.chunkSize=65e3,i.maxParticipantsAllowed=1e3,i.disconnectWith=R.disconnectWith,i.checkPresence=function(e,t){return"SSEConnection"===n.name?void SSEConnection.checkPresence(e,function(e,n){return i.socket?void t(e,n):(e||(i.userid=n),void i.connectSocket(function(){t(e,n)}))}):i.socket?void i.socket.emit("check-presence",(e||i.sessionid)+"",t):void i.connectSocket(function(){i.checkPresence(e,t)})},i.onReadyForOffer=function(e,t){i.multiPeersHandler.createNewPeer(e,t)},i.setUserPreferences=function(e){return i.dontAttachStream&&(e.dontAttachLocalStream=!0),i.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},i.updateExtraData=function(){i.socket.emit("extra-data-updated",i.extra)},i.enableScalableBroadcast=!1,i.maxRelayLimitPerUser=3,i.dontCaptureUserMedia=!1,i.dontAttachStream=!1,i.dontGetRemoteStream=!1,i.onReConnecting=function(e){i.enableLogs&&console.info("ReConnecting with",e.userid,"...")},i.beforeAddingStream=function(e){return e},i.beforeRemovingStream=function(e){return e},i.checkIfChromeExtensionAvailable=w,i.checkIfChromeExtensionAvailable=S,i.getChromeExtensionStatus=C,i.getScreenConstraints=function(e,t){m(i,t)&&(t=!0),y(function(t,n){t||(n=i.modifyScreenConstraints(n),e(t,n))},t)},i.modifyScreenConstraints=function(e){return e},i.onPeerStateChanged=function(e){i.enableLogs&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},i.isOnline=!0,d("online",function(){i.isOnline=!0}),d("offline",function(){i.isOnline=!1}),i.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(i.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),i.isLowBandwidth)){if(i.bandwidth={audio:!1,video:!1,screen:!1},i.mediaConstraints.audio&&i.mediaConstraints.audio.optional&&i.mediaConstraints.audio.optional.length){var O=[];i.mediaConstraints.audio.optional.forEach(function(e){void 0===e.bandwidth&&O.push(e)}),i.mediaConstraints.audio.optional=O}if(i.mediaConstraints.video&&i.mediaConstraints.video.optional&&i.mediaConstraints.video.optional.length){O=[];i.mediaConstraints.video.optional.forEach(function(e){void 0===e.bandwidth&&O.push(e)}),i.mediaConstraints.video.optional=O}}i.getExtraData=function(e){if(!e)throw"remoteUserId is required.";return i.peers[e]?i.peers[e].extra:{}},t.autoOpenOrJoin&&i.openOrJoin(i.sessionid),i.onUserIdAlreadyTaken=function(e,t){i.enableLogs&&console.warn("Userid already taken.",e,"Your new userid:",t),i.join(e)},i.onRoomFull=function(e){i.enableLogs&&console.warn(e,"is full.")},i.trickleIce=!0,i.version="3.4.5",i.onSettingLocalDescription=function(e){i.enableLogs&&console.info("Set local description for remote user",e.userid)},i.oneRoomAlreadyExist=function(e){i.enableLogs&&console.info('Server says "Room ',e,"already exist. Joining instead."),i.join(e)},i.resetScreen=function(){L=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},i.autoCreateMediaElement=!0,i.password=null}(this)};